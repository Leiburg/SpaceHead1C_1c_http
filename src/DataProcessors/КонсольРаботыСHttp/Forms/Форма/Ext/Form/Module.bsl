
&НаСервере
Процедура ПриСозданииНаСервере(Отказ, СтандартнаяОбработка)
	Схема = Элементы.Схема.СписокВыбора[0];
	ТипАвторизации = Элементы.ТипАвторизации.СписокВыбора[0];
КонецПроцедуры


&НаКлиенте
Процедура ВыполнитьЗапрос(Команда)
	ВыполнитьЗапросНаСервере();
	
	Элементы.ГруппаРазделы.ТекущаяСтраница = Элементы.РазделОтвет;
КонецПроцедуры

&НаСервере
Процедура ВыполнитьЗапросНаСервере()
	МножествоПараметровЗапроса = Новый Соответствие;
	МножествоЗаголовковЗапроса = Новый Соответствие;
	ДополнительныеПараметры = Новый Структура("Заголовки", МножествоЗаголовковЗапроса);
	
	Для Каждого Стр Из ПараметрыЗапроса.НайтиСтроки(Новый Структура("Активно", Истина)) Цикл
		Если МножественностьПараметровЗапроса Тогда
			ЗначениеПараметра = МножествоПараметровЗапроса.Получить(Стр.Ключ);
			Если ЗначениеПараметра = Неопределено Тогда
				МножествоПараметровЗапроса.Вставить(Стр.Ключ, Стр.Значение);
			Иначе
				Если ТипЗнч(ЗначениеПараметра) <> Тип("Массив") Тогда
					ИмеющеесяЗначениеПараметра = ЗначениеПараметра;
					
					ЗначениеПараметра = Новый Массив;
					ЗначениеПараметра.Добавить(ИмеющеесяЗначениеПараметра);
					
					МножествоПараметровЗапроса.Вставить(Стр.Ключ, ЗначениеПараметра);
				КонецЕсли;
				
				ЗначениеПараметра.Добавить(Стр.Значение);
			КонецЕсли;
		Иначе
			МножествоПараметровЗапроса.Вставить(Стр.Ключ, Стр.Значение);
		КонецЕсли;
	КонецЦикла;
	
	Для Каждого Стр Из ЗаголовкиЗапроса.НайтиСтроки(Новый Структура("Активно", Истина)) Цикл
		МножествоЗаголовковЗапроса.Вставить(Стр.Ключ, Стр.Значение);
	КонецЦикла;
	
	Если ТипАвторизации <> Элементы.ТипАвторизации.СписокВыбора[0].Значение Тогда
		ДополнительныеПараметры.Вставить(
			"Аутентификация",
			Новый Структура("Тип, Пользователь, Пароль", ТипАвторизации, ПользовательАвторизации, ПарольАвторизации)
		);
	КонецЕсли;
	
	ОтветHTTP = РаботаСHttp.Получить(ИдентификаторРесурса, МножествоПараметровЗапроса, ДополнительныеПараметры);
	КодСостояния = ОтветHTTP.КодСостояния;
	
	ЗаголовкиОтвета.Очистить();
	Для Каждого КЗ Из ОтветHTTP.Заголовки Цикл
		ЗаполнитьЗначенияСвойств(ЗаголовкиОтвета.Добавить(), КЗ);
	КонецЦикла;
	ЗаголовкиОтвета.Сортировать("Ключ");
	
	Ответ = ОтветHTTP.ПолучитьТелоКакСтроку();
КонецПроцедуры

&НаКлиенте
Процедура ЗаголовкиОтветаПриАктивизацииСтроки(Элемент)
	ТекущиеДанные = Элементы.ЗаголовкиОтвета.ТекущиеДанные;
	ЗначениеЗаголовкаОтвета = ?(ТекущиеДанные = Неопределено, "", ТекущиеДанные.Значение);
КонецПроцедуры

&НаКлиенте
Процедура ТипАвторизацииПриИзменении(Элемент)
	Отображать = (ТипАвторизации <> Элементы.ТипАвторизации.СписокВыбора[0].Значение);
	
	Элементы.ПользовательАвторизации.Видимость = Отображать;
	Элементы.ГруппаПарольАвторизации.Видимость = Отображать;
	
	ИзменитьРежимОтображенияПароля(НЕ Отображать);
КонецПроцедуры

&НаКлиенте
Процедура ПоказатьПарольАвторизации(Команда)
	ИзменитьРежимОтображенияПароля(НЕ Элементы.ПоказатьПарольАвторизации.Пометка);
КонецПроцедуры

&НаКлиенте
Процедура ИзменитьРежимОтображенияПароля(Знач РежимПароля)
	Элементы.ПоказатьПарольАвторизации.Пометка = РежимПароля;
	Элементы.ПарольАвторизации.РежимПароля = НЕ Элементы.ПоказатьПарольАвторизации.Пометка;
КонецПроцедуры
